js运行时会有一个队列来存放异步任务，包括网络请求，用户io等事件都会在这个队列中等待js执行

js有一个event loop机制来执行这个队列，队列中的任务分成宏任务和微任务，当js触发loop的时候
1. 从队列中出队一个宏任务，然后执行，没有宏任务的直接检查微任务
2. 执行过程中有可能产生宏任务和微任务，宏任务添加到队列末端，微任务添加到微任务队列
3. 宏任务执行完成后执行微任务检查点，如果当前微任务队列有任务就执行，一直到微任务队列被清空
4. 尝试渲染，如果浏览器判断当前不需要渲染（时间没到等），就不需要渲染，如果需要的话，其中就会调用`requestAnimationFrame`
5. 如果当前loop没有执行宏任务或者微任务或者渲染，就执行`requestIdleCallback`

## setTimeout在chrome的执行原理：
定时器线程会维护两个队列，一个是延时任务队列，储存延时任务回调和时间，一个是唤醒任务队列，只有时间
1. 当主线程执行setTimeout的时候，延时任务队列塞进一个延时任务
2. 检查当前唤醒任务队列，如果没有比它的时间更短的，就往唤醒任务队列里添加唤醒任务，然后拿出最小的时间，往系统上添加唤醒任务
3. 系统唤醒的时候，执行延时任务队列中的到期和过期的任务，执行完成后找到队列中最小的时间，添加唤醒任务，重复这一步

参考文档：https://www.zhihu.com/question/463446982