# 1. HTTP的缺陷
http是明文传输的，会遭受中间人攻击

# 2. TLS加密方法选择
加密方法有对称加密和非对称加密

1. 对称加密加解密速度快，但是如果中间人拿到密钥就能解密
2. 非对称加密加解密速度慢，但是拿不到私钥的就不能加密或解密，用于单向通信
3. 握手过程使用非对称加密传递对称加密的密钥，通信过程使用对称加密

# 3. 握手过程
## TLS1.2 + RSA
1. 客户端生成clientRandom、加密套件列表、tls版本号到服务器
2. 服务器生成serverRandom，确认加密套件，和CA证书返回客户端
3. 客户端确认证书，并且获取服务器公钥，生成pre-master并且使用公钥加密，返回服务器，并且生成对称加密密钥加密客户端信息摘要确认并发送
4. 服务器收到pre-master后，生成对称加密密钥并加密服务器信息摘要确认并且发送
4. 如摘要没问题则双方使用对称加密密钥进行传输，有问题的发起重新握手

## TLS1.2 + ECDHE
0. REA算法如果密钥泄漏，能解密之前的记录
1. 客户端发送加密套件、tls版本号、clientRandom
2. 服务器选择加密套件，发送serverParams、serverRandom、CA证书
3. 客户端发送clientParams、并且因为客户端已经能算出密钥，可以直接发送数据

## TLS1.3 + ECDHE
0. 因为tls1.3大幅删减了加密套件数量，所以可以客户端可以直接把各个套件的参数都计算出来，减少确认次数
1. 客户端发送clientParams、clientRandom、加密套件列表、tls版本到服务器，保存私钥到本地
2. 服务器确认加密套件，发送serverParams、serverRandom、CA证书到客户端，保存私钥到本地
3. 双方直接计算出密钥，直接通信，客户端不需要确认服务器选择，省略一次握手

# 4. 客户端如何确认证书
1. 服务器向CA请求证书，CA确认服务器信息后，生成证书
2. 证书包含服务器和证书信息（明文）、CA把明文使用hash生成摘要然后使用私钥加密得到证书签名
3. 客户端收到后使用跟CA同样的hash算出摘要，然后把签名使用CA公钥解密得到CA摘要，两者对比能得到是否被篡改
### 4.1 为什么不直接加密内容
加解密大文件速度慢，只需要加解密摘要就能确认是否篡改了