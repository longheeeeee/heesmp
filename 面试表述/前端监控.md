# 前端监控
前端监控分为采集、上报、储存、分析四个部分
正常页面的话，前端的工作集中在采集和上报这两个过程
## 采集
采集可以分成错误收集、性能收集两大方面：
### 错误收集
错误收集分成脚本错误和异步请求错误
#### 脚本错误
脚本错误可以使用四种方法来进行收集：
1. try-catch：代码入侵性比较强，无法捕获异步和语法错误，可以做特殊处理
2. window.onerror：可以捕获全局的js错误
3. window.addEventListener('error')：可以捕获资源加载错误和js错误，需要根onerror做区分
4. window.addEventListener('unhandledrejection')：捕获没有被处理的promise错误
- 需要注意的是，跨域脚本在执行的时候不会把错误细节抛出来，我们需要把脚本添加crossOrigin属性来把脚本转化成正式的跨域请求，服务器需要返回acao头，这样子校验通过后就可以获取错误细节了
#### 异步请求错误
重写xhr或者fetch来捕获错误

### 性能收集
主要是收集各种性能指标，使用performance的相关api实现

## 上报
上报方式分成三种：图片、ajax、sendBeacon
图片和ajax的缺点是在边界情况下可能会丢失请求，比如上报用户离开页面相关的信息
sendBeacon不会阻塞主线程，也不会受到页面卸载的印象，缺点是兼容性比较差
