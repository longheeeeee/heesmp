# 分成登录校验和权限系统

# 登录 passport登录方案
## 传统的cookie方案
登录后需要添加到cookie上，请求的时候会带上用户登录信息
1. 登录校验服务器压力巨大
2. （cookie有域名特性，需要后端配置白名单，在下发的时候对白名单进行setCookie）
## 长短票据方案
1. 短票，加密过的用户信息数据，客户端/服务器可以手动反解获取用户信息，不需要经过session服务器校验，（web端不能），短时间内过期，过期后使用长票通过session服务进行刷新
2. 长票，session登录凭证

### 踢登方案
长短票会存在用户被踢登之后仍然可以使用的问题
1. 核心服务/核心接口可以强制走长票校验
2. 单独存储踢登信息，每次都进行校验，但是最长只需要存储短票过期时长

# 权限方案
## 主流的权限方案
### ABAC attribute-base-access-control
通过动态计算一个或者一组属性是否能够通过授权，非常灵活，实现难度大，用于实现很细粒度的权限，比如控制一篇文章谁可以看
1. 主体属性，用户的年龄，性别等
2. 客体属性，文章，帖子
3. 环境属性，空间、时间、频率等
4. 操作属性，读/写
### RBAC role-base-access-control
所有的权限最终集成在角色上，用户只跟角色进行绑定
分成三个实体
1. 用户
2. 角色
3. 权限
## RBAC的拓展
1. RBAC1:增加了角色的继承关系
2. RBAC2:增加了角色的约束，比如互斥、数量等限制
## 实现
### 权限
1. 菜单权限
2. 操作权限
其实都是权限这个实体，只不过通过type对这两个概念进行了区分
1. 菜单权限是树形结构，带有pid，跟前端页面菜单一一对应，拥有路由属性
2. 功能权限，只能绑定到菜单权限节点上，拥有可自定义的权限code

### 角色
角色和权限属于多对多的关系
### 用户

### 校验
S项目权限校验
1. 直接获取到用户信息，包括菜单信息和权限code，保存在全局的slice上
2. 封装react HOC来决定是否展示children
3. 封装hook来获取是否存在权限，并且会自动更新
4. 暴露出方法来动态判断






# 其他
## 字节内部权限
使用角色集
登录方式有两种
1. 通过BSM账号体系登录，调用passport来获取userid
2. 通过字节SSO登录，在cookie内会带上dbmp_sso_session_id