# 1. 三次握手

### 1. 三次握手的目的
建立连接的双方互相确认双方的ISN是否正确发送和接收

### 2. ISN是什么
- ISN：初始序列号，用于滑动窗口组包
- 当新连接建立的时候，ISN生成器会生成一个32位的ISN，每4微秒加一，总长度大约4.5小时，比MSL长的多，所以认为ISN是唯一的

### 3. 三次握手
1. 客户端发送SYN=1，seq=X。SYN标志位，表示该包用于同步序列号。seq为客户端当前序号
2. 服务器发送SYN=1，seq=Y，ack=1，ackNum=X+1。ack是对客户端的包进行确认，确认收到X包
3. 客户端发送ACK=1，ackNum=Y+1.

### 4. 为什么是三次握手不是两次
> 为了防止已失效的连接请求报文突然又传送到了服务器，因而产生错误。 --计算机网络
交流信息来说两次握手就已经可以了，可是如果考虑丢包的情况，服务器的报文丢了，然后客户端接收到了旧的服务器报文，这样子不确认的情况下就会出错

# 2. 四次挥手

### 1. 过程
1. 客户端发送FIN=1，seq=X。FIN代表客户端想要关闭连接
2. 服务器发送ACK=1，ACKnum=X+1。代表服务器确认客户端的报文，但是服务器可能还有数据未发送完成，需要等待
3. 服务器发送FIN=1，seq=Y。服务器可以关闭连接了
4. 客户端发送ACK=1，ACKnum=Y+1。等待2MSL后关闭连接

### 2. 为什么要等待2MSL
如果服务器收不到客户端的确认信息，会尝试重传关闭报文，客户端需要等待接收报文并重传确认。并且等待当前四元组在网络上消亡。
- 四元组：源ip端口，目的ip端口

