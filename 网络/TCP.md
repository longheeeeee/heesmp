# 1. 三次握手

### 1. 三次握手的目的
建立连接的双方互相确认双方的ISN是否正确发送和接收

### 2. ISN是什么
- ISN：初始序列号，用于滑动窗口组包
- 当新连接建立的时候，ISN生成器会生成一个32位的ISN，每4微秒加一，总长度大约4.5小时，比MSL长的多，所以认为ISN是唯一的

### 3. 三次握手
1. 客户端发送SYN=1，seq=X。SYN标志位，表示该包用于同步序列号。seq为客户端当前序号
2. 服务器发送SYN=1，seq=Y，ack=1，ackNum=X+1。ack是对客户端的包进行确认，确认收到X包
3. 客户端发送ACK=1，ackNum=Y+1.

### 4. 为什么是三次握手不是两次
> 为了防止已失效的连接请求报文突然又传送到了服务器，因而产生错误。 --计算机网络
互相确认ISN来说两次握手就已经可以了，可是如果考虑丢包的情况，在第二次握手的时候，旧的SYN比新的SYN更先到达服务器，如果有第三次握手，客户端就可以知道服务器收到的是否是历史报文，从而断开链接

# 2. 四次挥手

### 1. 过程
1. 客户端发送FIN=1，seq=X。FIN代表客户端想要关闭连接
2. 服务器发送ACK=1，ACKnum=X+1。代表服务器确认客户端的报文，但是服务器可能还有数据未发送完成，需要等待
3. 服务器发送FIN=1，seq=Y。服务器可以关闭连接了
4. 客户端发送ACK=1，ACKnum=Y+1。等待2MSL后关闭连接

### 2. 为什么要等待2MSL
如果服务器收不到客户端的确认信息，会尝试重传关闭报文，客户端需要等待接收报文并重传确认。并且等待当前四元组在网络上消亡，防止短时间内重新发起连接，新旧连接数据会同时存在网络中。
- 四元组：源ip端口，目的ip端口

# TCP和UDP的区别
1. tcp基于连接，udp不基于连接
2. tcp包体大，udp包体小
3. tcp数据正确，udp不保证
4. tcp保证数据顺序，udp不保证

# UDP的使用场景
1. 即时通信工具（QQ）（使用确认包来确认对方收到当条信息）
2. 游戏
3. 直播视频